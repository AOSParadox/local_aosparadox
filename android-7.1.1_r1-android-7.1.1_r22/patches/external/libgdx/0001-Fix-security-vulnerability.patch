From 92aeb4c7896c0b4fa0a30b0a943f5f5eac28adb1 Mon Sep 17 00:00:00 2001
From: Jorim Jaggi <jjaggi@google.com>
Date: Tue, 29 Nov 2016 13:12:48 +0100
Subject: [PATCH] Fix security vulnerability

Change-Id: I19028233d2ce79ef08947f00d2ecba20312579cc
Fixes: 32769670
(cherry picked from commit 28d83109cba8e1949032c78465649ba21db2d22e)
(cherry picked from commit 890381c983b6eca60a435ebf5a4bdbd7a32660f0)
---
 gdx/jni/gdx2d/jpgd.cpp | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/gdx/jni/gdx2d/jpgd.cpp b/gdx/jni/gdx2d/jpgd.cpp
index 3873dfb..4c84a33 100644
--- a/gdx/jni/gdx2d/jpgd.cpp
+++ b/gdx/jni/gdx2d/jpgd.cpp
@@ -2231,7 +2231,10 @@ void jpeg_decoder::make_huff_table(int index, huff_tables *pH)
   for (l = 1; l <= 16; l++)
   {
     for (i = 1; i <= m_huff_num[index][l]; i++)
+    {
+      JPGD_ASSERT(p < 257);
       huffsize[p++] = static_cast<uint8>(l);
+    }
   }
 
   huffsize[p] = 0;
@@ -2246,6 +2249,7 @@ void jpeg_decoder::make_huff_table(int index, huff_tables *pH)
   {
     while (huffsize[p] == si)
     {
+      JPGD_ASSERT(p < 257);
       huffcode[p++] = code;
       code++;
     }
-- 
2.7.4

